(()=>{"use strict";const e=window.wp.i18n,t=window.React,n=window.wp.htmlEntities,a=window.wc.wcSettings,s=window.wc.wcBlocksRegistry,i=window.wp.data,r=window.wc.wcBlocksData,o=window.widgetSettings.pluginPrefix,l=window.widgetSettings.pluginTextDomain,c=window.widgetSettings.pluginTextName,d=window.widgetSettings.pluginWidgetName,p=window.widgetSettings.pluginProductionEnvironment,u=window.widgetSettings.pluginSandboxEnvironment,m={defaultLabel:(0,e.__)(c+" Payments",l),placeOrderButtonLabel:(0,e.__)("Place Order by "+c,l),validationError:(0,e.__)("Please fill in the required fields of the form to display payment methods",l),notAvailable:(0,e.__)("The payment method is not available in your country.",l)};let y=!1;((c,_,g,w,f)=>{const h=`${o}_${c}_a_p_m_s_block_data`,b=`${o}_${c}_a_p_m_s_gateway`,E=(0,a.getSetting)(h,{}),S=(0,n.decodeEntities)(E.title)||(0,e.__)(_,l),v=(0,i.select)(r.CART_STORE_KEY),k=()=>{const{total_price:e}=v.getCartTotals();return Number(e/100).toFixed(2)},C=e=>{const{eventRegistration:a,emitResponse:s}=e,{onPaymentSetup:i,onCheckoutValidation:r,onShippingRateSelectSuccess:o}=a,l=v.getCustomerData().billingAddress,_=v.getCustomerData().shippingAddress,h=v.getShippingRates(),b=jQuery(".plugin-country-available"),S=jQuery(".plugin-validation-error"),C=jQuery("#"+g),T=jQuery(".wc-block-components-checkout-place-order-button"),R=jQuery("#paymentCompleted");let x=((e,t)=>{for(let n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n])||!e[t[n]])return!1;return!0})(l,w),P=!!f.find((e=>e===l.country.toLowerCase())),A=null,$={},D={...E};return D.customers="",D.styles="",D.supports="",D.pickupLocations="",D.total_limitation&&delete D.total_limitation,S.hide(),b.hide(),C.hide(),x?x&&!P?(y=!1,b.show()):x&&P&&C.show():(y=!1,S.show()),setTimeout((()=>{if(x&&!y&&(y=!0,A=new window[d].AfterpayCheckoutButton("#"+g,E.publicKey,E.gatewayId),$={amount:k(),currency:E.currency,email:l.email,first_name:l.first_name,last_name:l.last_name,address_line:l.address_1,address_line2:l.address_2,address_city:l.city,address_state:l.state,address_postcode:l.postcode,address_country:l.country,phone:l.phone},D.gatewayType="afterpay"),A){A.onFinishInsert('input[name="payment_source_apm_token"]',"payment_source_token");const e={first_name:_.first_name,last_name:_.last_name,line1:_.address_1,line2:_.address_2,country:_.country,postcode:_.postcode,city:_.city,state:_.state};h.length&&h[0].shipping_rates.length&&h[0].shipping_rates.forEach(((t,n)=>{if(!t.selected)return;if(e.amount=Number((t.price/100).toFixed(3)).toFixed(2),e.currency=t.currency_code,"pickup_location"!==t.method_id)return;const a=t.rate_id.split(":"),s=E.pickupLocations[a[1]];e.line1=s.address.address_1,e.line2="",e.country=s.address.country,e.postcode=s.address.postcode,e.city=s.address.city,e.state=s.address.state})),$.charge={amount:k(),currency:E.currency,email:l.email,first_name:l.first_name,last_name:l.last_name,shipping_address:e,billing_address:{first_name:l.first_name,last_name:l.last_name,line1:l.address_1,line2:l.address_2,country:l.country,postcode:l.postcode,city:l.city,state:l.state},items:v.getCartData().items.map((e=>{const t={name:e.name,amount:e.prices.price/100,quantity:e.quantity,reference:e.short_description};return e.images.length>0&&(t.image_uri=e.images[0].src),t}))},A.setEnv(E.isSandbox?u:p),A.setMeta($),A.on("finish",(()=>{E.directCharge&&(D.directCharge=!0),E.fraud&&(D.fraud=!0,D.fraudServiceId=E.fraudServiceId),null!==T&&T.click(),R.show()}))}}),100),(0,t.useEffect)((()=>{const e=o((async()=>{const e=k(),t=(e,t)=>void 0!==e?{amount:t}:{};A.setMeta({...$,...t($.amount,e),charge:{...$.charge,...t($.charge.amount,e)}})})),t=i((async()=>{const e=document.querySelector('input[name="payment_source_apm_token"]');if(null!==e)return D.paymentSourceToken=e.value,D.paymentSourceToken.length>0||E.selectedToken.length>0?{type:s.responseTypes.SUCCESS,meta:{paymentMethodData:D}}:{type:s.responseTypes.ERROR,message:m.fillDataError}}));return()=>{const n=e=>"function"==typeof e?e():null;n(t),n(e),y=!1}}),[s.responseTypes.ERROR,s.responseTypes.SUCCESS,i,r]),(0,t.createElement)("div",{id:"pluginWidgetApm"},(0,t.createElement)("div",{id:"paymentCompleted",style:{display:"none","background-color":E.styles.background_color,color:E.styles.success_color,"font-size":E.styles.font_size,"font-family":E.styles.font_family}},"Payment Details Collected"),(0,t.createElement)("div",null,(0,n.decodeEntities)(E.description||"")),(0,t.createElement)("div",{class:"apms-button-wrapper"},(0,t.createElement)("button",{type:"button",id:g,class:`btn-apm btn-apm-${c}`,style:{display:"none"}},(0,t.createElement)("img",{src:`${window.widgetSettings.pluginUrlPrefix}assets/images/${c}.png`}))),(0,t.createElement)("div",{class:"plugin-validation-error"},m.validationError),(0,t.createElement)("input",{type:"hidden",name:"payment_source_apm_token"}),(0,t.createElement)("div",{class:"plugin-country-available",style:{display:"none"}},m.notAvailable))},T={name:b,label:(0,t.createElement)((()=>(0,t.createElement)("div",{className:"plugin-payment-method-label"},(0,t.createElement)("img",{src:`${window.widgetSettings.pluginUrlPrefix}assets/images/icons/${c}.png`,alt:S,className:`plugin-payment-method-label-icon ${c}`}),"  "+S))),content:(0,t.createElement)(C,null),edit:(0,t.createElement)(C,null),placeOrderButtonLabel:m.placeOrderButtonLabel,canMakePayment:()=>function(e,t){if(null===(n=e)||"object"!=typeof n)return!0;var n;let a=0,s=0;return e.max&&(s=100*e.max),e.min&&(a=100*e.min),a=t>=a,s=0===s||t<=s,a&&s}(E.total_limitation,v.getCartTotals()?.total_price),ariaLabel:S,supports:{features:E.supports}};(0,s.registerPaymentMethod)(T)})("afterpay",window.widgetSettings.pluginTextName+" Afterpay","pluginAPMsAfterpayButton",["first_name","last_name","email","address_1","city","state","country","postcode"],["au","nz","us","ca","uk","gb","fr","it","es","de"])})();