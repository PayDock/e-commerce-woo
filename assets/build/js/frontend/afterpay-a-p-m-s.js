(()=>{"use strict";const e=window.wp.i18n,t=window.React,a=window.wp.htmlEntities,n=window.wc.wcSettings,r=window.wc.wcBlocksRegistry,s=window.wp.data,o=window.wc.wcBlocksData,i="power_board",d={defaultLabel:(0,e.__)("PowerBoard Payments",i),placeOrderButtonLabel:(0,e.__)("Place Order by PowerBoard",i),validationError:(0,e.__)("Please fill in the required fields of the form to display payment methods",i),notAvailable:(0,e.__)("The payment method is not available in your country.",i)};let l=!1;((c,p,m,u,y)=>{const _=`power_board_${c}_a_p_m_s_block_data`,w=`power_board_${c}_a_p_m_s_gateway`,g=(0,n.getSetting)(_,{}),f=(0,a.decodeEntities)(g.title)||(0,e.__)("PowerBoard Afterpay",i),h=(0,s.select)(o.CART_STORE_KEY),b=e=>{const{eventRegistration:n,emitResponse:r}=e,{onPaymentSetup:s,onCheckoutValidation:o}=n,i=h.getCustomerData().billingAddress,p=h.getCustomerData().shippingAddress,_=h.getShippingRates(),w=jQuery(".power-board-country-available"),f=jQuery(".power-board-validation-error"),b=jQuery("#"+m),E=jQuery(".wc-block-components-checkout-place-order-button"),k=jQuery("#paymentCompleted");let v=((e,t)=>{for(let a=0;a<t.length;a++)if(!e.hasOwnProperty(t[a])||!e[t[a]])return!1;return!0})(i,u),S=!!y.find((e=>e===i.country.toLowerCase())),C=null,B={},P={...g};return P.customers="",P.styles="",P.supports="",P.pickupLocations="",P.total_limitation&&delete P.total_limitation,f.hide(),w.hide(),b.hide(),v?v&&!S?(l=!1,w.show()):v&&S&&b.show():(l=!1,f.show()),setTimeout((()=>{if(v&&!l&&(l=!0,C=new window.cba.AfterpayCheckoutButton("#"+m,g.publicKey,g.gatewayId),B={amount:g.amount,currency:g.currency,email:i.email,first_name:i.first_name,last_name:i.last_name,address_line:i.address_1,address_line2:i.address_2,address_city:i.city,address_state:i.state,address_postcode:i.postcode,address_country:i.country,phone:i.phone},P.gatewayType="afterpay"),C){C.onFinishInsert('input[name="payment_source_apm_token"]',"payment_source_token");const e={first_name:p.first_name,last_name:p.last_name,line1:p.address_1,line2:p.address_2,country:p.country,postcode:p.postcode,city:p.city,state:p.state};_.length&&_[0].shipping_rates.length&&_[0].shipping_rates.forEach(((t,a)=>{if(!t.selected)return;if(e.amount=Number((t.price/100).toFixed(3)).toFixed(2),e.currency=t.currency_code,"pickup_location"!==t.method_id)return;const n=t.rate_id.split(":"),r=g.pickupLocations[n[1]];e.line1=r.address.address_1,e.line2="",e.country=r.address.country,e.postcode=r.address.postcode,e.city=r.address.city,e.state=r.address.state})),B.charge={amount:g.amount,currency:g.currency,email:i.email,first_name:i.first_name,last_name:i.last_name,shipping_address:e,billing_address:{first_name:i.first_name,last_name:i.last_name,line1:i.address_1,line2:i.address_2,country:i.country,postcode:i.postcode,city:i.city,state:i.state},items:h.getCartData().items.map((e=>{const t={name:e.name,amount:e.prices.price/100,quantity:e.quantity,reference:e.short_description};return e.images.length>0&&(t.image_uri=e.images[0].src),t}))},C.setEnv(g.isSandbox?"preproduction_cba":"production_cba"),C.setMeta(B),C.on("finish",(()=>{g.directCharge&&(P.directCharge=!0),g.fraud&&(P.fraud=!0,P.fraudServiceId=g.fraudServiceId),null!==E&&E.click(),k.show()}))}}),100),(0,t.useEffect)((()=>{const e=s((async()=>{const e=document.querySelector('input[name="payment_source_apm_token"]');if(null!==e)return P.paymentSourceToken=e.value,P.paymentSourceToken.length>0||g.selectedToken.length>0?{type:r.responseTypes.SUCCESS,meta:{paymentMethodData:P}}:{type:r.responseTypes.ERROR,message:d.fillDataError}}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,s,o]),(0,t.createElement)("div",{id:"powerBoardWidgetApm"},(0,t.createElement)("div",{id:"paymentCompleted",style:{display:"none","background-color":g.styles.background_color,color:g.styles.success_color,"font-size":g.styles.font_size,"font-family":g.styles.font_family}},"Payment Details Collected"),(0,t.createElement)("div",null,(0,a.decodeEntities)(g.description||"")),(0,t.createElement)("div",{class:"apms-button-wrapper"},(0,t.createElement)("button",{type:"button",id:m,class:`btn-apm btn-apm-${c}`,style:{display:"none"}},(0,t.createElement)("img",{src:`${window.powerBoardWidgetSettings.pluginUrlPrefix}assets/images/${c}.png`}))),(0,t.createElement)("div",{class:"power-board-validation-error"},d.validationError),(0,t.createElement)("input",{type:"hidden",name:"payment_source_apm_token"}),(0,t.createElement)("div",{class:"power-board-country-available",style:{display:"none"}},d.notAvailable))},E={name:w,label:(0,t.createElement)((()=>(0,t.createElement)("div",{className:"power-board-payment-method-label"},(0,t.createElement)("img",{src:`${window.powerBoardWidgetSettings.pluginUrlPrefix}assets/images/icons/${c}.png`,alt:f,className:`power-board-payment-method-label-icon ${c}`}),"  "+f))),content:(0,t.createElement)(b,null),edit:(0,t.createElement)(b,null),placeOrderButtonLabel:d.placeOrderButtonLabel,canMakePayment:()=>function(e,t){let a=0,n=0;return e.max&&(n=100*e.max),e.min&&(a=100*e.min),a=t>=a,n=0===n||t<=n,a&&n}(g.total_limitation,h.getCartTotals()?.total_price),ariaLabel:f,supports:{features:g.supports}};(0,r.registerPaymentMethod)(E)})("afterpay",0,"powerBoardAPMsAfterpayButton",["first_name","last_name","email","address_1","city","state","country","postcode"],["au","nz","us","ca","uk","gb","fr","it","es","de"])})();