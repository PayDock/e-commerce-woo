(()=>{"use strict";var e={20:(e,t,n)=>{var o=n(609),i=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),r=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var o,l={},c=null,d=null;for(o in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,o)&&!a.hasOwnProperty(o)&&(l[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===l[o]&&(l[o]=t[o]);return{$$typeof:i,type:e,key:c,ref:d,props:l,_owner:r.current}}},848:(e,t,n)=>{e.exports=n(20)},609:e=>{e.exports=window.React}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}const o=window.wp.i18n,i=window.wc.wcBlocksRegistry,s=window.wp.htmlEntities,r=window.wc.wcSettings;var a=n(609);const l=window.wp.data,c=window.wc.wcBlocksData;var d=n(848);const u=window.widgetSettings.pluginWidgetName,p=window.widgetSettings.pluginTextName,m=window.widgetSettings.pluginPrefix,g=window.widgetSettings.pluginTextDomain,w=(0,l.select)(c.CHECKOUT_STORE_KEY),y=(0,l.select)(c.CART_STORE_KEY),h=(0,r.getSetting)(m+"_data",{}),_=(0,o.__)(p+" Payments",g),f=(0,s.decodeEntities)(h.title)||_;let k=null,v=null,E=null,S=null,j=null,x=null,T=null;const b=e=>{let t=document.getElementById("standaloneWidget"),n=document.getElementById("list"),o=document.getElementById("spinner");e?(t&&(t.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="none")):(t&&(t.style.display="flex"),n&&(n.style.display="flex"),o&&(o.style.display="flex"))},P=()=>{const e=jQuery(".wc-block-components-radio-control__input:checked").filter((function(){const e=jQuery(this).attr("id");return e.includes("rate")||e.includes("shipping")}));return e[0]?.value},C=()=>{if(function(e,t){if(null===(n=e)||"object"!=typeof n)return!0;var n;let o=0,i=0;return e.max&&(i=100*e.max),e.min&&(o=100*e.min),o=t>=o,i=0===i||t<=i,o&&i}(h.total_limitation,y.getCartTotals()?.total_price)){const e=(new Date).getTime();j=e,setTimeout((()=>(()=>{const e=document.querySelector(".wc-block-components-checkout-place-order-button");e&&(e.style.visibility="hidden")})()),100);const t=w.getOrderId();jQuery.ajax({url:"/?wc-ajax=woo-plugin-create-charge-intent",type:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_intent,order_id:t,total:y.getCartTotals(),address:y.getCustomerData().billingAddress,selected_shipping_id:P()},success:n=>{if(L()){if(e===j)if(n.success){b(!1);const e="#wooPluginCheckout_wrapper";if(!jQuery(e)[0])return;window.widgetWooPlugin=new window[u].Checkout(e,n.data.token),window.widgetWooPlugin.setEnv(h.environment);const o=jQuery(".wc-block-components-checkout-place-order-button")[0],i=jQuery("#paymentSourceToken");window.widgetWooPlugin.onPaymentSuccessful((function(e){jQuery.ajax({url:"/?wc-ajax=woo-plugin-process-payment-result",method:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_process_payment,order_id:t,payment_response:e,create_account:document.querySelector(".wc-block-components-checkbox.wc-block-checkout__create-account")?.querySelector("input").checked},success:function(n){n.success?(i.val(JSON.stringify({...e,orderId:t})),o.click(),window.widgetWooPlugin=null):(window.showWarning(n.data?.message),C())}})})),window.widgetWooPlugin.onPaymentFailure((function(e){i.val(JSON.stringify({errorMessage:"Transaction failed. Please check your payment details or contact your bank"})),jQuery.ajax({url:"/?wc-ajax=woo-plugin-process-payment-result",method:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_process_payment,order_id:w.getOrderId(),payment_response:{...e,errorMessage:e.message||"Transaction failed"}},success:function(){o.click(),window.widgetWooPlugin=null}})})),window.widgetWooPlugin.onPaymentExpired((function(e){i.val(JSON.stringify({errorMessage:"Your payment session has expired. Please retry your payment"})),e.charge_id?jQuery.ajax({url:"/?wc-ajax=woo-plugin-process-payment-result",method:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_process_payment,order_id:w.getOrderId(),payment_response:{...e,errorMessage:"Payment session has expired"}},success:function(){o.click(),window.widgetWooPlugin=null}}):(o.click(),window.widgetWooPlugin=null)}))}else{let e=jQuery("#intent-creation-error")[0],t=jQuery("#loading")[0];I(t,e)}}else{let e=jQuery("#required-fields-validation-error")[0],t=jQuery("#loading")[0];I(t,e)}}})}},L=()=>{let e=jQuery(".wc-block-components-form")[0].checkValidity()&&N()&&W();jQuery('.wc-block-checkout__use-address-for-billing input[type="checkbox"]').checked||(e=e&&Q()&&R());let t=document.getElementById("_woo_additional_terms");t&&!t.checked&&(e=!1);let n=document.getElementById("terms");return n&&!n.checked&&(e=!1),e},I=(e,t)=>{e.classList.add("hide"),t.classList.length>0&&t.classList.remove("hide")},O=(e=!1)=>{let t=L(),n=jQuery("#required-fields-validation-error")[0],o=jQuery("#intent-creation-error")[0],i=jQuery("#invalid-fields-error")[0],s=jQuery("#loading")[0];if(b(!0),o.classList.add("hide"),i.classList.add("hide"),t)s.classList.length>0&&s.classList.remove("hide"),n.classList.add("hide");else{const e=document.getElementById("shipping-postcode")?.checkValidity()&&document.getElementById("billing-postcode")?.checkValidity(),t=document.getElementById("email").checkValidity(),o=!document.getElementById("shipping-phone")?.className.includes(m+"-invalid-phone")&&!document.getElementById("billing-phone")?.className.includes(m+"-invalid-phone");e&&t&&o||(n.classList.add("hide"),n=i),I(s,n)}t&&!e&&(clearTimeout(window.initWidgetTimer),window.initWidgetTimer=setTimeout((()=>{C()}),500))};window.handleWidgetDisplay=O;const Q=()=>{const e=y.getCustomerData().billingAddress;return!!(e&&e.address_1&&e.city&&e.country&&e.email&&e.first_name&&e.last_name&&e.postcode&&e.state)},N=()=>{const e=y.getCustomerData().shippingAddress;return!!(e&&e.address_1&&e.city&&e.country&&e.first_name&&e.last_name&&e.postcode&&e.state)},W=()=>!document.getElementById("shipping-phone")?.classList?.contains("woo-plugin-invalid-phone"),R=()=>!document.getElementById("billing-phone")?.classList?.contains("woo-plugin-invalid-phone"),A=e=>{k&&clearTimeout(k),b(!0),k=setTimeout((()=>{const t=B(),n=+e.detail.cartTotal;t&&(t!==n?(v&&clearTimeout(v),v=setTimeout((()=>{const e=B();e&&(e!==n?window.reloadAfterExternalCartChanges():O())}),300)):O())}),300)},B=()=>{const e=jQuery(".wc-block-components-totals-footer-item-tax-value")[0];return e?+e?.innerText.replace(/[^0-9.,]*/,""):null},q=e=>{setTimeout((()=>{const t=y.getCustomerData().billingAddress,n=y.getCustomerData().shippingAddress,o=y.isShippingRateBeingSelected();E!==t||S!==n||e.target.id.includes("_woo_additional_terms")?(E=t,S=n,O()):o&&(()=>{x&&clearTimeout(x);const e=P();T!==e?x=setTimeout((()=>{T=e,jQuery.ajax({url:"/?wc-ajax=woo-plugin-update-shipping",type:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_update_shipping}})}),500):O(!0)})()}),0)},D=e=>{const{eventRegistration:t,emitResponse:n}=e,{onPaymentSetup:i}=t;(0,a.useEffect)((()=>{window.unsubscribeFromFormChanges||(window.unsubscribeFromFormChanges=jQuery(".wc-block-components-form")[0].addEventListener("change",(e=>q(e)))),window.cartChangesEventListenerSetup||(document.addEventListener(m+"_cart_total_changed",A),window.cartChangesEventListenerSetup=!0);const e=i((async()=>{const e=document.getElementById("paymentSourceToken")?.value,t=JSON.parse(e);return e&&!t.errorMessage?{type:n.responseTypes.SUCCESS,meta:{paymentMethodData:{payment_response:e,chargeId:t.charge_id,intentId:t.intent_id,orderId:t.order_id,_wpnonce:h._wpnonce}}}:((()=>{let e=document.getElementById("loading");e.classList.length>0&&e.classList.remove("hide"),b(!0),C();const t=document.querySelectorAll(".wc-block-checkout")[0].querySelectorAll(".wc-block-components-notices")[0],n=document.querySelectorAll(".wc-block-checkout__payment-method")[0],o=n?.querySelectorAll(".wc-block-components-checkout-step__content")?.[0],i=o?.querySelectorAll(".wc-block-components-notices")?.[0],s=setInterval((()=>{if(i?.children.length>0||t.children.length>0){clearInterval(s);const e=setTimeout((()=>{clearTimeout(e);const n=i?.children.length>0?i:t;for(const e of n.children)e.classList.contains("is-error")&&e.classList.add("hide")}),1e4)}}),200)})(),{type:n.responseTypes.ERROR,message:(0,o.__)(t.errorMessage,g)})}));return()=>{const t=jQuery(".wc-block-components-form")[0];t&&t.removeEventListener("change",q),document.removeEventListener(m+"_cart_total_changed",A),window.cartChangesEventListenerSetup=!1,e()}}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,i]);const s=(0,a.createElement)("input",{type:"hidden",id:"paymentSourceToken"});return(0,a.createElement)("div",{className:"master-widget-wrapper"},(0,a.createElement)("div",{id:"loading"},(0,a.createElement)("p",{className:"loading-text"},"Loading...")),(0,a.createElement)("div",{id:"required-fields-validation-error",className:"hide"},(0,a.createElement)("p",{className:"woo-plugin-validation-error"},"Please fill in the required fields of the form to display payment methods.")),(0,a.createElement)("div",{id:"intent-creation-error",className:"hide"},(0,a.createElement)("p",{className:"woo-plugin-validation-error"},"Something went wrong, please refresh the page and try again.")),(0,a.createElement)("div",{id:"invalid-fields-error",className:"hide"},(0,a.createElement)("p",{className:"woo-plugin-validation-error"},"Please enter valid information in all fields to display payment methods.")),(0,a.createElement)("div",{id:"wooPluginCheckout_wrapper"}),s)},M={name:m,label:(0,a.createElement)((()=>(0,a.createElement)("div",{className:"woo-plugin-payment-method-label"},f,(0,a.createElement)("img",{src:`${window.widgetSettings.pluginUrlPrefix}assets/images/logo.png`,alt:f,className:"woo-plugin-payment-method-label-logo"})))),content:(0,d.jsx)(D,{}),edit:(0,d.jsx)(D,{}),canMakePayment:()=>!0,ariaLabel:f,supports:{features:h.supports}};(0,i.registerPaymentMethod)(M)})();