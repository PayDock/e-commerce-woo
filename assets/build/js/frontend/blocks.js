(()=>{"use strict";const e=window.wp.i18n,t=window.wc.wcBlocksRegistry,o=window.wp.htmlEntities,n=window.wc.wcSettings,r=window.React,a=window.wp.data,s=window.wc.wcBlocksData,i=(0,a.select)(s.CHECKOUT_STORE_KEY),l=(0,a.select)(s.CART_STORE_KEY),c=(0,n.getSetting)("power_board_data",{}),d="power-board",w=(0,e.__)("PowerBoard Payments",d),u=(0,o.decodeEntities)(c.title)||w;let m=null,p=null,y=null;const g=e=>{let t=document.getElementById("standaloneWidget"),o=document.getElementById("list"),n=document.getElementById("spinner");e?(t&&(t.style.display="none"),o&&(o.style.display="none"),n&&(n.style.display="none")):(t&&(t.style.display="flex"),o&&(o.style.display="flex"),n&&(n.style.display="flex"))},b=()=>{if(function(e,t){if(null===(o=e)||"object"!=typeof o)return!0;var o;let n=0,r=0;return e.max&&(r=100*e.max),e.min&&(n=100*e.min),n=t>=n,r=0===r||t<=r,n&&r}(c.total_limitation,l.getCartTotals()?.total_price)){const e=(new Date).getTime();y=e,setTimeout((()=>(()=>{let e=document.querySelectorAll(".wc-block-components-checkout-place-order-button")[0];window.toggleOrderButton(e,!0)})()),100),jQuery.ajax({url:"/?wc-ajax=power-board-create-charge-intent",type:"POST",data:{_wpnonce:PowerBoardAjax.wpnonce,order_id:i.getOrderId(),total:l.getCartTotals(),address:l.getCustomerData().billingAddress},success:t=>{if(e===y){m=JSON.stringify(l.getCartData()),g(!1),window.widgetPowerBoard=new cba.Checkout("#powerBoardCheckout_wrapper",t.data.resource.data.token),window.widgetPowerBoard.setEnv(c.environment);const e=jQuery(".wc-block-components-checkout-place-order-button")[0],o=jQuery("#paymentSourceToken");window.widgetPowerBoard.onPaymentSuccessful((function(t){o.val(JSON.stringify(t)),e.click(),window.widgetPowerBoard=null})),window.widgetPowerBoard.onPaymentFailure((function(){o.val(JSON.stringify({errorMessage:"Transaction failed. Please check your payment details or contact your bank"})),e.click(),window.widgetPowerBoard=null})),window.widgetPowerBoard.onPaymentExpired((function(){o.val(JSON.stringify({errorMessage:"Your payment session has expired. Please retry your payment"})),e.click(),window.widgetPowerBoard=null}))}}})}},h=()=>{let e=jQuery(".wc-block-components-form")[0].checkValidity(),t=jQuery("#fields-validation-error")[0],o=jQuery("#loading")[0];g(!0),e?(o.classList.length>0&&o.classList.remove("hide"),t.classList.add("hide")):(o.classList.add("hide"),t.classList.length>0&&t.classList.remove("hide")),e&&(clearTimeout(window.initWidgetTimer),window.initWidgetTimer=setTimeout((()=>{b()}),500))},f=()=>{l.getCustomerData().billingAddress!==p&&(p=l.getCustomerData().billingAddress,h())},k=t=>{const{eventRegistration:o,emitResponse:n}=t,{onPaymentSetup:a}=o;(0,r.useEffect)((()=>{if(window.unsubscribeFromFormChanges||(window.unsubscribeFromFormChanges=jQuery(".wc-block-components-form")[0].addEventListener("change",f)),!window.unsubscribeFromMutateObserver){const e=setInterval((()=>{const t=jQuery(".wc-block-components-totals-footer-item-tax-value")[0];t&&(clearInterval(e),window.unsubscribeFromMutateObserver=new MutationObserver((function(e){e[0].oldValue!==t.innerHTML&&h()})),window.unsubscribeFromMutateObserver.observe(t,{childList:!0,characterData:!0,subtree:!0,characterDataOldValue:!0}))}),300)}const t=a((async()=>{const t=document.getElementById("paymentSourceToken")?.value,o=JSON.parse(t);return t&&!o.errorMessage?{type:n.responseTypes.SUCCESS,meta:{paymentMethodData:{payment_response:t,chargeId:o.charge_id,checkoutOrder:m,_wpnonce:c._wpnonce}}}:((()=>{let e=document.getElementById("loading");e.classList.length>0&&e.classList.remove("hide"),g(!0),b();const t=document.querySelectorAll(".wc-block-checkout")[0].querySelectorAll(".wc-block-components-notices")[0],o=document.querySelectorAll(".wc-block-checkout__payment-method")[0],n=o?.querySelectorAll(".wc-block-components-checkout-step__content")?.[0],r=n?.querySelectorAll(".wc-block-components-notices")?.[0],a=setInterval((()=>{if(r?.children.length>0||t.children.length>0){clearInterval(a);const e=setTimeout((()=>{clearTimeout(e);const o=r?.children.length>0?r:t;for(const e of o.children)e.classList.contains("is-error")&&e.classList.add("hide")}),1e4)}}),200)})(),{type:n.responseTypes.ERROR,message:(0,e.__)(o.errorMessage,d)})}));return()=>{jQuery(".wc-block-components-form")[0].removeEventListener("change",f),window.unsubscribeFromMutateObserver.disconnect(),t()}}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,a]);const s=(0,r.createElement)("input",{type:"hidden",id:"paymentSourceToken"});return(0,r.createElement)("div",{className:"master-widget-wrapper"},(0,r.createElement)("div",{id:"loading"},(0,r.createElement)("p",{className:"loading-text"},"Loading...")),(0,r.createElement)("div",{id:"fields-validation-error",className:"hide"},(0,r.createElement)("p",{className:"power-board-validation-error"},"Please fill in the required fields of the form to display payment methods")),(0,r.createElement)("div",{id:"powerBoardCheckout_wrapper"}),s)},v={name:"power_board_gateway",label:(0,r.createElement)((()=>(0,r.createElement)("div",{className:"power-board-payment-method-label"},u,(0,r.createElement)("img",{src:`${window.powerBoardWidgetSettings.pluginUrlPrefix}assets/images/logo.png`,alt:u,className:"power-board-payment-method-label-logo"})))),content:(0,r.createElement)(k,null),edit:(0,r.createElement)(k,null),canMakePayment:()=>!0,ariaLabel:u,supports:{features:c.supports}};(0,t.registerPaymentMethod)(v)})();