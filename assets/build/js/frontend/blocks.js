(()=>{"use strict";const e=window.wp.i18n,t=window.wc.wcBlocksRegistry,o=window.wp.htmlEntities,n=window.wc.wcSettings,a=window.React,r=window.wp.data,s=window.wc.wcBlocksData,i=(0,r.select)(s.CHECKOUT_STORE_KEY),d=(0,r.select)(s.CART_STORE_KEY),l=(0,n.getSetting)("power_board_data",{}),c="power-board",w=(0,e.__)("PowerBoard Payments",c),m=(0,o.decodeEntities)(l.title)||w,p=e=>{let t=document.getElementById("standaloneWidget"),o=document.getElementById("list"),n=document.getElementById("spinner");e?(t&&(t.style.display="none"),o&&(o.style.display="none"),n&&(n.style.display="none")):(t&&(t.style.display="flex"),o&&(o.style.display="flex"),n&&(n.style.display="flex"))},u=()=>{(function(e,t){if(null===(o=e)||"object"!=typeof o)return!0;var o;let n=0,a=0;return e.max&&(a=100*e.max),e.min&&(n=100*e.min),n=t>=n,a=0===a||t<=a,n&&a})(l.total_limitation,d.getCartTotals()?.total_price)&&jQuery.ajax({url:"/?wc-ajax=power-board-create-charge-intent",type:"POST",data:{_wpnonce:PowerBoardAjax.wpnonce,order_id:i.getOrderId(),total:d.getCartTotals(),address:d.getCustomerData().billingAddress},success:e=>{setTimeout((()=>{p(!1),window.widgetPowerBoard=new cba.Checkout("#powerBoardCheckout_wrapper",e.data.resource.data.token),window.widgetPowerBoard.setEnv(l.environment);const t=jQuery(".wc-block-components-checkout-place-order-button"),o=jQuery("#paymentSourceToken");window.widgetPowerBoard.onPaymentSuccessful((function(e){o.val(JSON.stringify(e)),t.show(),t.click(),window.widgetPowerBoard=null})),window.widgetPowerBoard.onPaymentFailure((function(e){o.val(JSON.stringify({errorMessage:e.message})),t.show(),t.click(),window.widgetPowerBoard=null})),window.widgetPowerBoard.onPaymentExpired((function(){o.val(JSON.stringify({errorMessage:"Your payment session has expired. Please try again."})),t.show(),t.click(),window.widgetPowerBoard=null}))}),0)}})},y=()=>{let e=jQuery(".wc-block-components-form")[0].checkValidity(),t=jQuery("#fields-validation-error")[0],o=jQuery("#loading")[0];p(!0),e?(o.classList.remove("hide"),t.classList.add("hide"),u()):(o.classList.add("hide"),t.classList.remove("hide"))},g=t=>{jQuery(".wc-block-components-checkout-place-order-button").show();const{eventRegistration:o,emitResponse:n}=t,{onPaymentSetup:r}=o;(0,a.useEffect)((()=>{window.unsubscribeFromFormChanges||(window.unsubscribeFromFormChanges=jQuery(".wc-block-components-form")[0].addEventListener("change",y));const t=r((async()=>{const t=document.getElementById("paymentSourceToken")?.value,o=JSON.parse(document.getElementById("paymentSourceToken")?.value);return t&&!o.errorMessage?{type:n.responseTypes.SUCCESS,meta:{paymentMethodData:{payment_response:t,chargeId:o.charge_id,_wpnonce:l._wpnonce}}}:(u(),{type:n.responseTypes.ERROR,message:(0,e.__)(o.errorMessage,c)})}));return()=>{jQuery(".wc-block-components-form")[0].removeEventListener("change",y),t()}}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,r]);const s=(0,a.createElement)("input",{type:"hidden",id:"paymentSourceToken"});return(0,a.createElement)("div",{className:"master-widget-wrapper"},(0,a.createElement)("div",{id:"loading"},(0,a.createElement)("p",{className:"loading-text"},"Loading...")),(0,a.createElement)("div",{id:"fields-validation-error",className:"hide"},(0,a.createElement)("p",{className:"power-board-validation-error"},"Please fill in the required fields of the form to display payment methods")),(0,a.createElement)("div",{id:"powerBoardCheckout_wrapper"}),s)},E={name:"power_board_gateway",label:(0,a.createElement)((()=>(0,a.createElement)("div",{className:"power-board-payment-method-label"},m,(0,a.createElement)("img",{src:`${window.powerBoardWidgetSettings.pluginUrlPrefix}assets/images/commBank_logo.png`,alt:m,className:"power-board-payment-method-label-logo"})))),content:(0,a.createElement)(g,null),edit:(0,a.createElement)(g,null),canMakePayment:()=>!0,ariaLabel:m,supports:{features:l.supports}};(0,t.registerPaymentMethod)(E)})();