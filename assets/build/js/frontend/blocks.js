(()=>{"use strict";const e=window.wp.i18n,t=window.wc.wcBlocksRegistry,n=window.wp.htmlEntities,o=window.wc.wcSettings,i=window.React,s=window.wp.data,r=window.wc.wcBlocksData,a=window.widgetSettings.pluginWidgetName,c=window.widgetSettings.pluginTextName,l=window.widgetSettings.pluginPrefix,d=window.widgetSettings.pluginTextDomain,u=(0,s.select)(r.CHECKOUT_STORE_KEY),m=(0,s.select)(r.CART_STORE_KEY),p=(0,o.getSetting)(l+"_data",{}),g=(0,e.__)(c+" Payments",d),w=(0,n.decodeEntities)(p.title)||g;let y=null,h=null,_=null,f=null,k=null;const E=e=>{let t=document.getElementById("standaloneWidget"),n=document.getElementById("list"),o=document.getElementById("spinner");e?(t&&(t.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="none")):(t&&(t.style.display="flex"),n&&(n.style.display="flex"),o&&(o.style.display="flex"))},S=()=>{const e=jQuery(".wc-block-components-radio-control__input:checked").filter((function(){const e=jQuery(this).attr("id");return e.includes("rate")||e.includes("shipping")}));return e[0]?.value},v=()=>{if(function(e,t){if(null===(n=e)||"object"!=typeof n)return!0;var n;let o=0,i=0;return e.max&&(i=100*e.max),e.min&&(o=100*e.min),o=t>=o,i=0===i||t<=i,o&&i}(p.total_limitation,m.getCartTotals()?.total_price)){const e=(new Date).getTime();k=e,setTimeout((()=>(()=>{const e=document.querySelector(".wc-block-components-checkout-place-order-button");e&&(e.style.visibility="hidden")})()),100),jQuery.ajax({url:"/?wc-ajax=woo-plugin-create-charge-intent",type:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_intent,order_id:u.getOrderId(),total:m.getCartTotals(),address:m.getCustomerData().billingAddress,selected_shipping_id:S()},success:t=>{if(T()){if(e===k)if(t.success){E(!1);const e="#wooPluginCheckout_wrapper";if(!jQuery(e)[0])return;window.widgetWooPlugin=new window[a].Checkout(e,t.data.token),window.widgetWooPlugin.setEnv(p.environment);const n=jQuery(".wc-block-components-checkout-place-order-button")[0],o=jQuery("#paymentSourceToken");window.widgetWooPlugin.onPaymentSuccessful((function(e){const t=u.getOrderId();jQuery.ajax({url:"/?wc-ajax=woo-plugin-process-payment-result",method:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_process_payment,order_id:t,payment_response:e,create_account:document.querySelector(".wc-block-components-checkbox.wc-block-checkout__create-account")?.querySelector("input").checked},success:function(i){i.success?(o.val(JSON.stringify({...e,orderId:t})),n.click(),window.widgetWooPlugin=null):(window.showWarning(i.data.message),v())}})})),window.widgetWooPlugin.onPaymentFailure((function(e){o.val(JSON.stringify({errorMessage:"Transaction failed. Please check your payment details or contact your bank"})),jQuery.ajax({url:"/?wc-ajax=woo-plugin-process-payment-result",method:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_process_payment,order_id:u.getOrderId(),payment_response:{...e,errorMessage:e.message||"Transaction failed"}},success:function(){n.click(),window.widgetWooPlugin=null}})})),window.widgetWooPlugin.onPaymentExpired((function(e){o.val(JSON.stringify({errorMessage:"Your payment session has expired. Please retry your payment"})),e.charge_id?jQuery.ajax({url:"/?wc-ajax=woo-plugin-process-payment-result",method:"POST",data:{_wpnonce:WooPluginAjaxCheckout.wpnonce_process_payment,order_id:u.getOrderId(),payment_response:{...e,errorMessage:"Payment session has expired"}},success:function(){n.click(),window.widgetWooPlugin=null}}):(n.click(),window.widgetWooPlugin=null)}))}else{let e=jQuery("#intent-creation-error")[0],t=jQuery("#loading")[0];b(t,e)}}else{let e=jQuery("#fields-validation-error")[0],t=jQuery("#loading")[0];b(t,e)}}})}},T=()=>{let e=jQuery(".wc-block-components-form")[0].checkValidity()&&x()&&C();return jQuery('.wc-block-checkout__use-address-for-billing input[type="checkbox"]').checked||(e=e&&P()&&L()),e},b=(e,t)=>{e.classList.add("hide"),t.classList.length>0&&t.classList.remove("hide")},j=(e=!1)=>{let t=T(),n=jQuery("#fields-validation-error")[0],o=jQuery("#intent-creation-error")[0],i=jQuery("#loading")[0];E(!0),o.classList.add("hide"),t?(i.classList.length>0&&i.classList.remove("hide"),n.classList.add("hide")):b(i,n),t&&!e&&(clearTimeout(window.initWidgetTimer),window.initWidgetTimer=setTimeout((()=>{v()}),500))};window.handleWidgetDisplay=j;const P=()=>{const e=m.getCustomerData().billingAddress;return!!(e&&e.address_1&&e.city&&e.country&&e.email&&e.first_name&&e.last_name&&e.postcode&&e.state)},x=()=>{const e=m.getCustomerData().shippingAddress;return!!(e&&e.address_1&&e.city&&e.country&&e.first_name&&e.last_name&&e.postcode&&e.state)},C=()=>!document.getElementById("shipping-phone")?.classList?.contains("woo-plugin-invalid-phone"),L=()=>!document.getElementById("billing-phone")?.classList?.contains("woo-plugin-invalid-phone"),Q=e=>{y&&clearTimeout(y),E(!0),y=setTimeout((()=>{const t=W(),n=+e.detail.cartTotal;t&&(t!==n?(h&&clearTimeout(h),h=setTimeout((()=>{const e=W();e&&(e!==n?window.reloadAfterExternalCartChanges():j())}),300)):j())}),300)},W=()=>{const e=jQuery(".wc-block-components-totals-footer-item-tax-value")[0];return e?+e?.innerText.replace(/[^0-9.,]*/,""):null},I=()=>{setTimeout((()=>{const e=m.getCustomerData().billingAddress,t=m.getCustomerData().shippingAddress,n=m.isShippingRateBeingSelected();_!==e||f!==t?(_=e,f=t,j()):n&&j(!0)}),0)},O=t=>{const{eventRegistration:n,emitResponse:o}=t,{onPaymentSetup:s}=n;(0,i.useEffect)((()=>{window.unsubscribeFromFormChanges||(window.unsubscribeFromFormChanges=jQuery(".wc-block-components-form")[0].addEventListener("change",I)),window.cartChangesEventListenerSetup||(document.addEventListener(l+"_cart_total_changed",Q),window.cartChangesEventListenerSetup=!0);const t=s((async()=>{const t=document.getElementById("paymentSourceToken")?.value,n=JSON.parse(t);return t&&!n.errorMessage?{type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{payment_response:t,chargeId:n.charge_id,intentId:n.intent_id,orderId:n.order_id,_wpnonce:p._wpnonce}}}:((()=>{let e=document.getElementById("loading");e.classList.length>0&&e.classList.remove("hide"),E(!0),v();const t=document.querySelectorAll(".wc-block-checkout")[0].querySelectorAll(".wc-block-components-notices")[0],n=document.querySelectorAll(".wc-block-checkout__payment-method")[0],o=n?.querySelectorAll(".wc-block-components-checkout-step__content")?.[0],i=o?.querySelectorAll(".wc-block-components-notices")?.[0],s=setInterval((()=>{if(i?.children.length>0||t.children.length>0){clearInterval(s);const e=setTimeout((()=>{clearTimeout(e);const n=i?.children.length>0?i:t;for(const e of n.children)e.classList.contains("is-error")&&e.classList.add("hide")}),1e4)}}),200)})(),{type:o.responseTypes.ERROR,message:(0,e.__)(n.errorMessage,d)})}));return()=>{const e=jQuery(".wc-block-components-form")[0];e&&e.removeEventListener("change",I),document.removeEventListener(l+"_cart_total_changed",Q),window.cartChangesEventListenerSetup=!1,t()}}),[o.responseTypes.ERROR,o.responseTypes.SUCCESS,s]);const r=(0,i.createElement)("input",{type:"hidden",id:"paymentSourceToken"});return(0,i.createElement)("div",{className:"master-widget-wrapper"},(0,i.createElement)("div",{id:"loading"},(0,i.createElement)("p",{className:"loading-text"},"Loading...")),(0,i.createElement)("div",{id:"fields-validation-error",className:"hide"},(0,i.createElement)("p",{className:"woo-plugin-validation-error"},"Please fill in the required fields of the form to display payment methods")),(0,i.createElement)("div",{id:"intent-creation-error",className:"hide"},(0,i.createElement)("p",{className:"woo-plugin-validation-error"},"Something went wrong, please refresh the page and try again.")),(0,i.createElement)("div",{id:"wooPluginCheckout_wrapper"}),r)},A={name:l,label:(0,i.createElement)((()=>(0,i.createElement)("div",{className:"woo-plugin-payment-method-label"},w,(0,i.createElement)("img",{src:`${window.widgetSettings.pluginUrlPrefix}assets/images/logo.png`,alt:w,className:"woo-plugin-payment-method-label-logo"})))),content:(0,i.createElement)(O,null),edit:(0,i.createElement)(O,null),canMakePayment:()=>!0,ariaLabel:w,supports:{features:p.supports}};(0,t.registerPaymentMethod)(A)})();