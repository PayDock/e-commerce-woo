(()=>{"use strict";const e=window.wp.i18n,t=window.wc.wcBlocksRegistry,a=window.wp.htmlEntities,o=window.wc.wcSettings,n=window.wp.data,r=window.wc.wcBlocksData,l=window.React;let s={};const i=(e,t,a,o)=>{const n=jQuery("#paymentSourceWalletsToken"),r=jQuery("#paymentCompleted"),l=jQuery(".wc-block-components-checkout-place-order-button");let i={country:a.county};"#powerBoardWalletApplePayButton"===t&&(i.wallets=["apple"],i.amount_label="Total"),"#powerBoardWalletPayPalButton"===t&&(i.pay_later=a.pay_later,i.style={height:55}),"#powerBoardWalletAfterpayButton"===t&&jQuery("#powerBoardWalletAfterpayButton").each(((e,t)=>t.addEventListener("click",(()=>{l.click()}),!0))),s.current&&delete s.current,console.log(window.cba),console.log(t,a.token,i,o),s.current=new window.cba.WalletButtons(t,a.token,i),s.current.setEnv(o?"staging_cba":"production_cba"),s.current.onPaymentSuccessful((a=>{a.payment=e.replace("-","_"),n.val(JSON.stringify(a)),r.show(),jQuery(t).hide(),l.show(),l.click()})),s.current.onPaymentError((()=>{l.click()})),s.current.onPaymentInReview((a=>{a.payment=e.replace("-","_"),n.val(JSON.stringify(a)),r.show(),jQuery(t).hide(),l.show(),l.click()})),s.current.load()},c="power_board",d={validationError:(0,e.__)("Please fill in the required fields of the form to display payment methods",c),fillDataError:(0,e.__)("The payment service does not accept payment. Please try again later or choose another payment method.",c),notAvailable:(0,e.__)("Payment method is not avalaible for your country!!!",c)},p=["au","nz","us","ca","uk","gb","fr","it","es","de"];let y={initData:null,total:0};const u=powerBoardWidgetSettings.wpnonce_wallet;((s,m,w,g)=>{const _=`power_board_${s}_wallet_block_data`,h=`power_board_${s}_wallets_gateway`,E=(0,o.getSetting)(_,{}),b=(0,a.decodeEntities)(E.title)||(0,e.__)("PowerBoard Afterpay",c),f=(0,n.select)(r.CHECKOUT_STORE_KEY),S=(0,n.select)(r.CART_STORE_KEY);let v;const k=()=>{v.length&&y.total!==S.getCartTotals()?.total_price&&(jQuery("#"+w).each(((e,t)=>{t.innerHTML=""})),y.total=S.getCartTotals()?.total_price,v.each(((e,t)=>t.innerHTML="")),jQuery.ajax({url:"/wp-admin/admin-ajax.php",type:"POST",data:{action:"create_wallet_charge",data:{type:s,order_id:f.getOrderId(),total:S.getCartTotals(),address:S.getCustomerData().billingAddress,shipping_address:S.getCustomerData().shippingAddress,shipping_rates:S.getShippingRates(),items:S.getCartData().items,_wpnonce:u}},success:function(e){e.data.error?y.wasInit=!1:(y.initData=e.data,setTimeout((()=>{i(s,"#"+w,y.initData,E.isSandbox,y.reload)}),0))}}))},T=e=>{v=jQuery("#"+w);const{eventRegistration:t,emitResponse:o}=e,{onPaymentSetup:n,onCheckoutValidation:r,onShippingRateSelectSuccess:c}=t,u=S.getCustomerData().billingAddress,m=jQuery(".power-board-country-available");let _=((e,t)=>{for(let a=0;a<t.length;a++)if(!e.hasOwnProperty(t[a])||!e[t[a]])return!1;return!0})(u,g);jQuery(".wc-block-components-checkout-place-order-button").hide(),_&&!p.find((e=>e===u.country.toLowerCase()))?m.show():!_||y.initData||y.wasInit?_&&y.initData&&!v.length&&(m.hide(),setTimeout((()=>{i(s,"#"+w,y.initData,E.isSandbox)}),0)):(m.hide(),k()),(0,l.useEffect)((()=>{const e=c((async()=>{const e=y.total,t=S.getCartTotals()?.total_price;e!==t&&function(e,t){if(null===(a=e)||"object"!=typeof a)return!0;var a;let o=0,n=0;return e.max&&(n=100*e.max),e.min&&(o=100*e.min),o=t>=o,n=0===n||t<=n,o&&n}(E.total_limitation,t)&&k()})),t=r((async e=>_&&!!document.getElementById("paymentSourceWalletsToken").value||{type:o.responseTypes.ERROR,errorMessage:d.fillDataError})),a=n((async e=>document.getElementById("paymentSourceWalletsToken").value?{type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{payment_response:document.getElementById("paymentSourceWalletsToken").value,wallets:JSON.stringify(E.wallets),_wpnonce:E._wpnonce}}}:{type:o.responseTypes.ERROR,errorMessage:d.fillDataError}));return()=>{a()&&t()&&e()}}),[o.responseTypes.ERROR,o.responseTypes.SUCCESS,n]);const h=(0,l.createElement)("div",null,(0,a.decodeEntities)(E.description||"")),b=(0,l.createElement)("input",{type:"hidden",id:"paymentSourceWalletsToken"}),f=(0,l.createElement)("div",{id:"paymentCompleted",style:{display:"none","background-color":E.styles.background_color,color:E.styles.success_color,"font-size":E.styles.font_size,"font-family":E.styles.font_family}},"Payment Details Collected"),T=[(0,l.createElement)("div",{id:w,class:"paudock-wallets-buttons"})];return(0,l.createElement)("div",null,h,f,(0,l.createElement)("div",{id:"powerBoardWidgetWallets",class:"power-board-widget-content"},...T),(0,l.createElement)("div",{class:"power-board-validation-error",style:{display:_?"none":""}},d.validationError),(0,l.createElement)("div",{class:"power-board-country-available",style:{display:"none"}},d.notAvailable),b)},B={name:h,label:(0,l.createElement)((()=>(0,l.createElement)("div",{className:"power-board-payment-method-label"},(0,l.createElement)("img",{src:`${window.powerBoardWidgetSettings.pluginUrlPrefix}assets/images/icons/${s}.png`,alt:b,className:`power-board-payment-method-label-icon ${s}`}),"  "+b))),content:(0,l.createElement)(T,null),edit:(0,l.createElement)(T,null),canMakePayment:()=>!0,ariaLabel:b,supports:{features:E.supports}};(0,t.registerPaymentMethod)(B)})("afterpay",0,"powerBoardWalletAfterpayButton",["first_name","last_name","email","address_1","city","state","country","postcode"])})();